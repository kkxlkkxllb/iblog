(function(t){function e(e){for(var r,s,o=e[0],c=e[1],u=e[2],l=0,h=[];l<o.length;l++)s=o[l],n[s]&&h.push(n[s][0]),n[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);d&&d(e);while(h.length)h.shift()();return i.push.apply(i,u||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],r=!0,s=1;s<a.length;s++){var c=a[s];0!==n[c]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=a[0]))}return t}var r={},n={app:0},i=[];function s(t){return o.p+"js/"+({pdfjsWorker:"pdfjsWorker"}[t]||t)+"."+{pdfjsWorker:"287d4441"}[t]+".js"}function o(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(t){var e=[],a=n[t];if(0!==a)if(a)e.push(a[2]);else{var r=new Promise(function(e,r){a=n[t]=[e,r]});e.push(a[2]=r);var i,c=document.createElement("script");c.charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.src=s(t),i=function(e){c.onerror=c.onload=null,clearTimeout(u);var a=n[t];if(0!==a){if(a){var r=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+r+": "+i+")");s.type=r,s.request=i,a[1](s)}n[t]=void 0}};var u=setTimeout(function(){i({type:"timeout",target:c})},12e4);c.onerror=c.onload=i,document.head.appendChild(c)}return Promise.all(e)},o.m=t,o.c=r,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(a,r,function(e){return t[e]}.bind(null,r));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/",o.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var d=u;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0f97":function(t,e,a){},1:function(t,e){},1743:function(t,e,a){},2:function(t,e){},"2c52":function(t,e,a){},"2f6d":function(t,e,a){},3:function(t,e){},"38ae":function(t,e,a){"use strict";var r=a("2c52"),n=a.n(r);n.a},"38fc":function(t,e,a){},"3d23":function(t,e,a){"use strict";var r=a("fa8e"),n=a.n(r);n.a},4:function(t,e){},4678:function(t,e,a){var r={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function n(t){var e=i(t);return a(e)}function i(t){var e=r[t];if(!(e+1)){var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}return e}n.keys=function(){return Object.keys(r)},n.resolve=i,t.exports=n,n.id="4678"},"483e":function(t,e,a){"use strict";var r=a("38fc"),n=a.n(r);n.a},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var r=a("2b0e"),n=a("30f4"),i=a("dd88"),s=a("4d7d"),o=a("efa6"),c=a.n(o),u=a("a925"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content",attrs:{id:"app"}},[t.showLoading?a("mu-linear-progress",{attrs:{size:2,color:"#EE0B5B"}}):t._e(),a("router-view"),a("mu-dialog",{attrs:{"dialog-class":"login-dialog",open:t.requireLogin},on:{"update:open":function(e){t.requireLogin=e}}},[a("mu-alert",{attrs:{color:"warning"}},[a("mu-icon",{attrs:{value:"priority_high"}}),t._v("\n      "+t._s(t.$t("app.requireLoginTip"))+"\n    ")],1),a("login-form",{on:{logined:function(e){t.requireLogin=!1}}})],1),a("mu-dialog",{attrs:{"dialog-class":"loading-dialog",open:t.showLoadingDialog},on:{"update:open":function(e){t.showLoadingDialog=e}}},[a("mu-circular-progress",{attrs:{color:"secondary",size:36}}),a("div",{staticClass:"msg"},[t._v(t._s(t.loadingMsg||t.$t("app.loading")))])],1)],1)},d=[],h=new r["a"],f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-register"},[a("mu-tabs",{attrs:{value:t.activeTab,"full-width":"",color:"secondary",inverse:""},on:{"update:value":function(e){t.activeTab=e}}},[a("mu-tab",{attrs:{value:"tab1"}},[t._v(t._s(t.$t("account.userLogin")))]),a("mu-tab",{attrs:{value:"tab2"}},[t._v(t._s(t.$t("account.userRegister")))])],1),"tab1"===t.activeTab?a("form",{staticClass:"login-form",on:{submit:function(e){return e.preventDefault(),t.doLogin(e)}}},[a("mu-text-field",{attrs:{type:"email",name:"email",label:t.$t("account.email"),fullWidth:!0,labelFloat:!0,required:!0,lazy:""},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("mu-text-field",{attrs:{type:"password",label:t.$t("account.pwd"),name:"password",fullWidth:!0,labelFloat:!0,required:!0,lazy:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("mu-button",{attrs:{color:"primary",type:"submit",fullWidth:""}},[t._v("\n      "+t._s(t.$t("account.login"))+"\n    ")])],1):t._e(),"tab2"===t.activeTab?a("form",{staticClass:"register-form",on:{submit:function(e){return e.preventDefault(),t.doRegister(e)}}},[a("mu-text-field",{attrs:{label:t.$t("account.nick"),name:"nick",fullWidth:!0,labelFloat:!0,maxLength:10,required:!0},model:{value:t.nick,callback:function(e){t.nick=e},expression:"nick"}}),a("mu-text-field",{attrs:{type:"email",name:"email",label:t.$t("account.email"),fullWidth:!0,labelFloat:!0,required:!0},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("mu-text-field",{attrs:{type:"password",label:t.$t("account.pwd"),name:"password",fullWidth:!0,labelFloat:!0,required:!0},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("mu-button",{attrs:{color:"primary",type:"submit",fullWidth:""}},[t._v("\n      "+t._s(t.$t("account.register"))+"\n    ")])],1):t._e()],1)},p=[],m=a("b621"),v=a.n(m),g={name:"LoginForm",props:{},data:function(){return{activeTab:"tab1",email:"",password:"",nick:""}},methods:{doLogin:function(t){var e=this;v.a.auth.login({email:this.email,password:this.password}).then(function(t){e.$store.commit("SET_CURRENT_USER",t.toJSON()),e.$emit("logined")}).catch(function(t){console.error(t),e.$toast.error("登录失败")})},doRegister:function(t){var e=this;this.nick.length<=10&&v.a.auth.register({password:this.password,email:this.email}).then(function(t){t.set("displayName",e.nick).update().then(function(t){console.log(t)})}).catch(function(t){console.error(t),e.$toast.error("注册失败")})}}},y=g,b=(a("f5e8"),a("2877")),C=Object(b["a"])(y,f,p,!1,null,"44e06d7a",null),w=C.exports,_={name:"App",components:{LoginForm:w},data:function(){return{requireLogin:!1,showLoading:!1,showLoadingDialog:!1,loadingMsg:null}},created:function(){var t=this;h.$on("requireLogin",function(){t.requireLogin=!0}),h.$on("load:start",function(e){if(e)return t.loadingMsg=e,void(t.showLoadingDialog=!0);t.showLoading=!0}),h.$on("load:end",function(){t.showLoadingDialog=!1,t.showLoading=!1})}},k=_,j=(a("7faf"),Object(b["a"])(k,l,d,!1,null,null,null)),L=j.exports,S=a("8c4f"),x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"e-container"},[a("mu-appbar",{staticClass:"record-ctrl",attrs:{color:"primary","z-depth":0}},[a("mu-button",{staticClass:"logo",attrs:{slot:"left",icon:""},slot:"left"},[a("mu-icon",{attrs:{value:":icon-17up"}})],1),a("mu-button",{staticClass:"frame-nav-disp",attrs:{slot:"left",flat:"",primary:""},on:{click:function(e){t.showFrameListPop=!0}},slot:"left"},[t._v(t._s(t.frameNavDisplay))]),a("mu-button",{staticClass:"record-btn",class:{recording:t.currentTs},attrs:{slot:"right",flat:"",primary:""},on:{click:t.startRecord},slot:"right"},[a("mu-icon",{attrs:{left:"",value:"fiber_manual_record"}}),t._v("\n      "+t._s(t.currentTs?t.currentTsDisplay:t.$t("editor.recordStart"))+"\n    ")],1),a("mu-button",{directives:[{name:"show",rawName:"v-show",value:t.currentTs,expression:"currentTs"}],attrs:{slot:"right",flat:""},on:{click:t.pauseRecord},slot:"right"},[a("mu-icon",{attrs:{left:"",value:t.recordPaused?"play_arrow":"pause"}}),t._v("\n      "+t._s(t.recordPaused?t.$t("editor.resume"):t.$t("editor.pause"))+"\n    ")],1),a("mu-menu",{attrs:{slot:"right",open:t.openMoreMenu,placement:"bottom-end"},on:{"update:open":function(e){t.openMoreMenu=e}},slot:"right"},[a("mu-button",{attrs:{flat:""}},[a("mu-icon",{attrs:{value:"more_vert"}})],1),a("mu-list",{attrs:{slot:"content"},slot:"content"},[a("mu-list-item",{attrs:{button:"",to:"/mywork"}},[a("mu-list-item-title",[t._v(t._s(t.$t("editor.mywork")))])],1),a("mu-list-item",{attrs:{button:""},on:{click:function(e){t.showPreference=!0}}},[a("mu-list-item-title",[t._v(t._s(t.$t("editor.preference")))])],1),a("mu-list-item",{attrs:{button:"",to:"/contact"}},[a("mu-list-item-title",[t._v(t._s(t.$t("editor.feedback")))])],1)],1)],1)],1),a("mu-dialog",{attrs:{fullscreen:"",transition:"none","dialog-class":"frame-list-pop",open:t.showFrameListPop},on:{"update:open":function(e){t.showFrameListPop=e}}},[a("mu-appbar",{attrs:{color:"primary",title:t.$t("editor.viewFrameList"),"z-depth":0}},[a("mu-button",{attrs:{slot:"left",icon:""},on:{click:function(e){t.showFrameListPop=!1}},slot:"left"},[a("mu-icon",{attrs:{value:"close"}})],1),a("mu-button",{attrs:{slot:"right",flat:""},on:{click:t.removeCurFrame},slot:"right"},[a("mu-icon",{attrs:{left:"",value:"delete_forever"}}),t._v("\n        "+t._s(t.$t("editor.deleteCurFrame"))+"\n      ")],1)],1),a("div",{directives:[{name:"lazy-container",rawName:"v-lazy-container",value:{selector:"img"},expression:"{ selector: 'img' }"}],staticClass:"list-container"},t._l(t.frameList,function(e,r){return a("div",{key:e.id,staticClass:"frame-item",class:{cur:t.currentFrame===r+1},attrs:{"data-num":r+1},on:{click:function(){return t.handleNavToFrame(r)}}},[e.bg?a("img",{attrs:{"data-src":t.CDN_PF+e.bg.url+"!/fw/200",alt:r+1}}):t._e()])}),0)],1),a("div",{staticClass:"frame-ctrl nav-prev",on:{click:function(){return t.handleNavFrame(-1)}}},[a("mu-icon",{attrs:{value:"chevron_left"}})],1),a("div",{staticClass:"frame-ctrl nav-next",on:{click:function(){return t.handleNavFrame(1)}}},[a("mu-icon",{attrs:{value:t.currentFrame<t.frameList.length?"chevron_right":"plus_one"}})],1),a("div",{ref:"canvasWrap",staticClass:"canvas-container",style:t.maxCanvasH,on:{scroll:t.handleScroll}},[a("canvas-layer",{ref:"canvas",attrs:{width:t.viewSize[0],wrapHeight:t.viewSize[1]},on:{capture:t.handleCapture}})],1),a("div",{staticClass:"divider"},[t._v(t._s(t.$t("editor.canvasHTip"))+t._s(t.viewSize[1])+"px")]),a("control-bar",{on:{convertPdf:t.handleConvertPdf,compressImage:t.handleCompressImage,undo:t.handleUndoEarse}}),a("mu-dialog",{attrs:{width:"400",title:t.$t("editor.pausedRecordTip"),open:t.recordPaused,"overlay-close":!1},on:{"update:open":function(e){t.recordPaused=e}}},[a("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:t.pauseRecord},slot:"actions"},[t._v("\n      "+t._s(t.$t("editor.recordResume"))+"\n    ")])],1),a("mu-dialog",{attrs:{title:t.$t("editor.preference"),width:"460",open:t.showPreference},on:{"update:open":function(e){t.showPreference=e}}},[a("mu-list",[a("mu-sub-header",[t._v(t._s(t.$t("editor.canvasPref")))]),a("mu-list-item",{attrs:{button:"",ripple:!1},on:{click:function(e){t.blackboard=!t.blackboard}}},[a("mu-list-item-title",[t._v("\n          "+t._s(t.$t("editor.blackboardMode"))+" "),a("small",{staticClass:"second"},[t._v(t._s(t.$t("editor.blackboardModeSub")))])]),a("mu-list-item-action",[a("mu-switch",{attrs:{readonly:""},model:{value:t.blackboard,callback:function(e){t.blackboard=e},expression:"blackboard"}})],1)],1),a("mu-sub-header",[t._v(t._s(t.$t("editor.pencilPref")))]),a("mu-list-item",{attrs:{ripple:!1}},[a("mu-list-item-title",[t._v("\n          "+t._s(t.$t("editor.pencilT"))+" "+t._s(t.tolerance)+" "),a("small",{staticClass:"second"},[t._v(t._s(t.$t("editor.pencilTSub")))])]),a("mu-list-item-action",[a("mu-slider",{staticClass:"tolerance-slider",attrs:{max:8,step:1,min:1},model:{value:t.tolerance,callback:function(e){t.tolerance=e},expression:"tolerance"}})],1)],1),a("mu-sub-header",[t._v(t._s(t.$t("editor.langPref")))]),a("mu-list-item",[a("mu-select",{attrs:{"full-width":""},model:{value:t.lang,callback:function(e){t.lang=e},expression:"lang"}},[a("mu-option",{attrs:{label:"中文",value:"zh"}}),a("mu-option",{attrs:{label:"English",value:"en"}})],1)],1)],1)],1)],1)},$=[],T=(a("96cf"),a("3b8d")),R=(a("7514"),a("7618")),P=a("2ef0"),E=a.n(P),O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"layerContainer",staticClass:"canvas-layer-wrap",style:t.layerContainerHeight},[t.isPlayer?t._e():a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"pdfLayer",style:t.pdfLayerStyle,attrs:{width:t.pdfCanvasW,height:t.pdfCanvasH}}),a("div",{staticClass:"canvas-layer",style:t.layerStyle+t.bgColor},[t.needCapture?a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"captureLayer",style:t.captureLayerStyle,attrs:{width:t.canvasW,height:t.captureH}}):t._e(),a("canvas",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fakeLayer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),a("canvas",{ref:"stageLayer",staticClass:"stage-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),a("canvas",{ref:"displayLayer",staticClass:"display-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}),t.isPlayer?a("canvas",{ref:"syncLayer",staticClass:"sync-layer",style:t.layerStyle,attrs:{width:t.canvasW,height:t.canvasH}}):t._e(),t.isPlayer?t._e():a("canvas",{ref:"editLayer",staticClass:"edit-layer",style:t.layerStyle+t.cursorStyle,attrs:{width:t.canvasW,height:t.canvasH},on:{mousedown:t.handleMousedown,touchstart:t.handleMousedown,mousemove:t.handleMousemove,touchmove:t.handleMousemove,mouseup:t.handleMouseup,touchend:t.handleMouseup,mouseout:t.handleMouseout}}),t.isPlayer?a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCursor,expression:"showCursor"}],staticClass:"sync-cursor",style:t.syncCursorPos}):t._e()])])},A=[],M=(a("6c7b"),a("456d"),a("768b")),F=(a("ac4d"),a("8a81"),a("ac6a"),a("c5f6"),a("4d29")),N=a.n(F),B=a("8dee"),D=a.n(B),z=a("75fc");a("91fc");function W(t){return Math.max.apply(Math,t)}function H(t){return Math.min.apply(Math,t)}function I(t){var e=t.map(function(t){return t[0]}),a=t.map(function(t){return t[1]});return[H(e),H(a),W(e)-H(e),W(a)-H(a)]}function U(t,e){return 1!==e?t*e+.5<<0:t}function q(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=Math.round(e[0]*a-t.lineWidth/2-.5),n=Math.round(e[1]*a-t.lineWidth/2-.5),i=Math.round(e[2]*a+t.lineWidth+.5),s=Math.round(e[3]*a+t.lineWidth+.5);t.clearRect(r,n,i,s)}function V(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;q(t,I(e),a),e=[]}function G(t,e,a){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(r&&t.clearCurve(),1===e.length){var n=e[0];return t.beginPath(),t.arc(U(n[0],a),U(n[1],a),t.lineWidth/2,0,2*Math.PI,!0),t.closePath(),void t.fill()}t.beginPath();var i=U(e[0][0],a),s=U(e[0][1],a);if(t.moveTo(i,s),2===e.length)return t.lineTo(U(e[1][0],a),U(e[1][1],a)),void t.stroke();var o=1;while(o<e.length-2){var c=U((e[o][0]+e[o+1][0])/2,a),u=U((e[o][1]+e[o+1][1])/2,a),l=U(e[o][0],a),d=U(e[o][1],a);t.quadraticCurveTo(l,d,c,u),o++}var h=U(e[o][0],a),f=U(e[o][1],a),p=U(e[o+1][0],a),m=U(e[o+1][1],a);t.quadraticCurveTo(h,f,p,m),t.stroke()}function Y(t,e,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return{x:Math.min(t,a)/n,y:Math.min(e,r)/n,w:Math.abs(a-t)/n,h:Math.abs(r-e)/n}}function J(t,e,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.beginPath(),t.arc(e*r,a*r,4,2*Math.PI,!1),t.closePath(),t.lineWidth=1,t.stroke()}function X(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e.forEach(function(e){switch(e.ty){case"C":var r=e.po[0],n=e.po[e.po.length-1];J(t,r[0],r[1],a),J(t,n[0],n[1],a);break;case"MC":t.save(),t.setLineDash([5]),G(t,e.po,a,!1),t.restore();break;case"S":switch(e.sty){case"L":case"AL":J(t,e.data[0],e.data[1],a),J(t,e.data[2],e.data[3],a);break;case"C":at(t,e.data,a);break;case"R":et(t,e.data,a);break}}})}function K(t,e){var a,r,n,i,s,o;return!(!t||!e)&&(s=function(t,e){return!(t[1]<e[0]||t[0]>e[1])},a=[t.x,t.x+t.w],t.w<0&&(a=[a[1],a[0]]),r=[e.x,e.x+e.w],n=[t.y,t.y+t.h],t.h<0&&(n=[n[1],n[0]]),i=[e.y,e.y+e.h],o=s(a,r)&&s(n,i),o)}function Q(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[],n=e.x+e.w,i=e.y+e.h;return t.forEach(function(t){switch(t.ty){case"C":case"MC":if(a.unclude_curve)break;var s=!0,o=!1,c=void 0;try{for(var u,l=t.po[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var d=u.value;if(d[0]>=e.x&&d[0]<=n&&d[1]>=e.y&&d[1]<=i){r.push(t);break}}}catch($){o=!0,c=$}finally{try{s||null==l.return||l.return()}finally{if(o)throw c}}break;case"S":if(a.only_curve)break;var h=Y.apply(void 0,Object(z["a"])(t.data));switch(t.sty){case"R":case"C":K(e,h)&&r.push(t);break;case"L":case"AL":var f=[t.data[0],t.data[1]],p=[t.data[2],t.data[3]],m=h.w,v=h.h,g=[h.x,h.y],y=[h.x+h.w,h.y+h.h],b=m/7,C=1,w=[f,p];while(g[0]+b*C<y[0]){var _=g[0]+b*C,k=v/m*b*C,j=void 0;j=(p[1]-f[1])*(p[0]-f[0])>0?k+g[1]:y[1]-k,w.push([_,j]),C+=1}for(var L=0,S=w;L<S.length;L++){var x=S[L];if(x[0]>=e.x&&x[0]<=n&&x[1]>=e.y&&x[1]<=i){r.push(t);break}}break}}}),r}function Z(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;t.save(),t.lineWidth=2,t.strokeStyle=r,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(e[0]*a,e[1]*a),t.lineTo(e[2]*a,e[3]*a),t.stroke(),t.restore()}function tt(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,n=10;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r),t.lineCap="round",t.lineJoin="round";var i=e[2],s=e[3],o=Math.atan2(e[3]-e[1],e[2]-e[0]);t.beginPath(),t.moveTo(e[0]*a,e[1]*a),t.lineTo(e[2]*a,e[3]*a),t.moveTo(i,s),t.lineTo(i-n*Math.cos(o-Math.PI/6),s-n*Math.sin(o-Math.PI/6)),t.moveTo(i,s),t.lineTo(i-n*Math.cos(o+Math.PI/6),s-n*Math.sin(o+Math.PI/6)),t.stroke(),t.restore()}function et(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r);var n=Y.apply(void 0,Object(z["a"])(e).concat([a]));t.strokeRect(n.x,n.y,n.w,n.h),t.restore()}function at(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,n=Y.apply(void 0,Object(z["a"])(e).concat([a])),i=n.x+n.w/2,s=n.y+n.h/2;t.save(),t.lineWidth=2,r&&(t.strokeStyle=r),t.beginPath(),t.ellipse(i,s,n.w/2,n.h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}a("34ef"),a("28a5"),a("a481");function rt(t,e){var a,r,n;return a=(new Date).getTime()+t,r=null,n=function(){return a+=t,r=setTimeout(n,a-(new Date).getTime()),e()},r=setTimeout(n,a-(new Date).getTime()),{cancel:function(){return clearTimeout(r)}}}function nt(t,e){var a=t.replace("#",""),r=parseInt(a.substring(0,2),16),n=parseInt(a.substring(2,4),16),i=parseInt(a.substring(4,6),16);return"rgba("+r+","+n+","+i+","+e/100+")"}function it(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);var a=t.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),n=0;while(n<e.length)r[n]=e.charCodeAt(n),n++;return new Blob([r],{type:a})}var st,ot={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,a,r,n,i,s,o,c="",u=0;t=this._utf8_encode(t);while(u<t.length)e=t.charCodeAt(u++),a=t.charCodeAt(u++),r=t.charCodeAt(u++),n=e>>2,i=(3&e)<<4|a>>4,s=(15&a)<<2|r>>6,o=63&r,isNaN(a)?s=o=64:isNaN(r)&&(o=64),c=c+this._keyStr.charAt(n)+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(o);return c},decode:function(t){var e,a,r,n,i,s,o,c="",u=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(u<t.length)n=this._keyStr.indexOf(t.charAt(u++)),i=this._keyStr.indexOf(t.charAt(u++)),s=this._keyStr.indexOf(t.charAt(u++)),o=this._keyStr.indexOf(t.charAt(u++)),e=n<<2|i>>4,a=(15&i)<<4|s>>2,r=(3&s)<<6|o,c+=String.fromCharCode(e),64!=s&&(c+=String.fromCharCode(a)),64!=o&&(c+=String.fromCharCode(r));return c=this._utf8_decode(c),c},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",a=0;a<t.length;a++){var r=t.charCodeAt(a);r<128?e+=String.fromCharCode(r):r>127&&r<2048?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e},_utf8_decode:function(t){var e,a,r,n="",i=0;e=a=0;while(i<t.length)e=t.charCodeAt(i),e<128?(n+=String.fromCharCode(e),i++):e>191&&e<224?(a=t.charCodeAt(i+1),n+=String.fromCharCode((31&e)<<6|63&a),i+=2):(a=t.charCodeAt(i+1),r=t.charCodeAt(i+2),n+=String.fromCharCode((15&e)<<12|(63&a)<<6|63&r),i+=3);return n}},ct=(a("3b2b"),a("4917"),a("c1df")),ut=a.n(ct),lt=a("69a0"),dt=a.n(lt),ht="libiao.ubairn.com",ft="up17org.b0.upaiyun.com",pt="https://libiao.ubairn.com",mt=[{name:"咖啡色",value:"#655643"},{name:"粉色",value:"#FF9E9D"},{name:"橙色",value:"#ec8749"},{name:"蓝色",value:"#0088ff"},{name:"红色",value:"#e74000"},{name:"绿色",value:"#5cb85c"},{name:"白色",value:"#ffffff"},{name:"黑色",value:"#1d1d1d"}],vt="/ftriDMtpThOrkDlXwhbIZCE46Y=",gt="up17org";function yt(t){return t.match(ft)?t.replace(ft,ht):t.match(ht)?t:pt+t}var bt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Math.round((new Date).getTime()/1e3)+3600,r=e.thumb||"image"===t&&"/quality/75/format/webp/compress/true/progressive/true",n=ut()().format("YYYY_MM_DD_HH_")+D.a.generate();if(r){var i=r.match(/crop\/(\d+x\d+a+\d+a+\d+)/);i&&i.length>1&&(n+=i[1])}var s="/file/"+t+"/"+n,o={bucket:gt,expiration:a,"save-key":s};if(r&&(o["x-gmkerl-thumb"]=r),e.apps){var c=s+"."+e.apps.f;o["apps"]=[{name:"naga",type:"audio",save_as:c,avopts:"/f/"+e.apps.f}]}var u=ot.encode(JSON.stringify(o));e.done({signature:dt.a.hash(u+"&"+vt),policy:u,bucket:gt,"save-key":s,expiration:a})};function Ct(t,e,a){st?e?(Object.keys(st).forEach(function(t){e.append(t,st[t])}),a(e)):a(st):bt(t,{done:function(r){st=r,Ct(t,e,a)}})}function wt(t,e){r["a"].axios({method:"POST",url:"https://v0.api.upyun.com/up17org",data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){var a=t.data;200===a.code&&e(a)})}function _t(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(a,r){Ct("image",new FormData,function(r){r.append("file",e?it(t):t),wt(r,function(t){a({url:t.url,h:t["image-height"]/2,w:t["image-width"]/2,size:t.file_size})})})})}function kt(t){return new Promise(function(e,a){bt("audio",{apps:{f:"MP3"},done:function(a){var r=new FormData;r.append("file",t),r.append("content-type","audio/ogg"),Object.keys(a).forEach(function(t){r.append(t,a[t])}),wt(r,function(t){e(t.url)})}})})}function jt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,a=new v.a.TableObject("video"),r=new v.a.Query,n=20,i=["-cd"];t.uid?r.compare("created_by","=",+t.uid):t.cateId&&r.compare("cate_id","=",t.cateId),(t.uid||t.cateId)&&i.push("-uinfo"),(t.recent||t.hidePrivate)&&r.compare("is_private","!=",!0),t.classid&&r.arrayContains("classids",[t.classid]),t.keyword&&r.matches("t",new RegExp(t.keyword,"i")),t.onlyCount?a.setQuery(r).select("created_at").find().then(function(t){if(200===t.statusCode){var a=t.data.meta.total_count;console.log("共有 "+a+" 条记录"),e(a)}}):a.setQuery(r).select(i).orderBy("-created_at").limit(n).expand("created_by").offset(t.offset||0).find().then(function(t){if(200===t.statusCode){var a=t.data.objects;console.log("共查询到 "+a.length+" 条记录",a);var r=[],n=!0,i=!1,s=void 0;try{for(var o,c=a[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var u=o.value;r.push(Object.assign({},u,{duration:ut()(u.dur).format("mm:ss"),cover_url:yt(u.cover_url),count:u.n||0,c_at:ut()(1e3*u.created_at).format("lll")}))}}catch(l){i=!0,s=l}finally{try{n||null==c.return||c.return()}finally{if(i)throw s}}e(r,t.data.meta.next,t.data.meta.total_count)}})}function Lt(t,e,a){var r=new v.a.TableObject("video");r.expand("created_by").get(t).then(function(t){var a=JSON.parse(t.data.cd),r=a.canvas.find(function(t){return"AU"===t.ac});e(Object.assign({},t.data,{duration:ut()(t.data.dur).format("mm:ss"),cover_url:yt(t.data.cover_url),count:t.data.n||0,c_at:ut()(1e3*t.data.created_at).format("lll"),cd:a,ap:r?r.data:t.data.ap}))},a)}function St(t,e){var a=new v.a.TableObject("video");a.delete(t).then(e)}function xt(t){var e=new v.a.TableObject("video"),a=e.getWithoutData(t);a.incrementBy("n",1),a.update()}function $t(t,e){var a=new v.a.TableObject("video"),r=a.create();r.set(t).save().then(function(t){201===t.statusCode&&(console.log("创建video成功, objectId:"+t.data.id),e(t.data.id))})}function Tt(t){return"string"===typeof t&&0===t.indexOf("#")?t:t.indexOf("rgba")>-1?t:mt[t].value}var Rt={name:"CanvasLayer",props:{wrapHeight:{default:506,type:Number,require:!0},isPlayer:{default:!1,type:Boolean},width:{default:900,type:Number},playerBgColor:{default:"#fff",type:String},needCapture:{default:!1,type:Boolean}},data:function(){return{height:this.wrapHeight,curX:0,curY:0,curOp:1,curColor:"#333333",scaleRate:1,straX:!1,straY:!1,pdfHeight:this.wrapHeight,showCursor:!1}},mounted:function(){this.imageDict={},this.canvasObjs=[],this.earseHistoryObjs=[],this._points=[],this.ctxScaleRatio(),this.isPlayer?this.setupSyncLayer():(this.setupEditLayer(),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup))},beforeDestroy:function(){this.isPlayer||(document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup))},computed:{layerContainerHeight:function(){if(this.isPlayer)return"height:"+this.wrapHeight*this.scaleRate+"px;"},layerStyle:function(){return"width:"+this.width*this.scaleRate+"px;height:"+this.height*this.scaleRate+"px;"},pdfLayerStyle:function(){return"width:"+this.width+"px;height:"+this.pdfHeight+"px;"},captureLayerStyle:function(){return"width:"+this.width+"px;height:"+this.wrapHeight+"px;"},captureH:function(){return this.wrapHeight*window.devicePixelRatio},pdfCanvasH:function(){return 2*this.pdfHeight},pdfCanvasW:function(){return 2*this.width},bgColor:function(){return this.isPlayer?"background-color:"+this.playerBgColor:"background-color:"+this.$store.getters.currentBgColor},canvasW:function(){return this.width*window.devicePixelRatio*this.scaleRate},canvasH:function(){return this.height*window.devicePixelRatio*this.scaleRate},color:function(){return this.$store.getters.currentColor},cursorStyle:function(){switch(this.layerType){case"E":case"S":return"cursor: crosshair;";default:var t="url('"+pt+"/img/circle_"+this.$store.getters.colorIndex+".svg')";return window.devicePixelRatio>1?"cursor: -webkit-image-set("+t+" 2x) 6 6, auto;":"cursor: "+t+" 6 6, auto;"}},tolerance:function(){return this.$store.getters.preferences.tolerance},lineWidth:function(){return this.$store.getters.currentLineWidth},layerType:function(){return this.$store.getters.currentLayerType},shapeType:function(){return this.$store.getters.currentShapeType},syncCursorPos:function(){return"transform: translateX("+this.curX*this.scaleRate+"px) translateY("+this.curY*this.scaleRate+"px) scale("+this.scaleRate+","+this.scaleRate+"); opacity:"+this.curOp+"; background-color:"+this.curColor+";width: 12px;height: 12px;border-radius: 12px;margin-top: -6px;margin-left: -6px;"}},watch:{layerType:function(t,e){this.setupEditLayer()},scaleRate:function(t,e){var a=this;this.$nextTick(function(){a.ctxScaleRatio()})}},methods:{ctxScaleRatio:function(){var t=this;["displayLayer","stageLayer","editLayer","fakeLayer","syncLayer"].forEach(function(e){var a=t.$refs[e];a&&a.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)})},setupEditLayer:function(){var t=this.getLayerCtx("editLayer");switch(this.layerType){case"C":break;case"E":t.strokeStyle="#ff8619",t.fillStyle="rgba(255, 255, 255,0.4)",t.lineCap="round",t.lineJoin="round",t.lineWidth=1;break;case"S":break}},setupSyncLayer:function(){},scrollLayerContainer:function(t){this.$refs.layerContainer.scrollTop=t*this.scaleRate},preloadStage:function(t,e){var a=this;return new Promise(function(r,n){if(a.imageDict[e])r(a.imageDict[e]);else{var i=new window.Image;i.onload=function(){a.imageDict[e]=i,i=null,r(a.imageDict[e])},i.src=yt(t.url)}})},preloadStages:function(){var t=Object(T["a"])(regeneratorRuntime.mark(function t(e){var a,r,n,i,s,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a=!0,r=!1,n=void 0,t.prev=3,i=e[Symbol.iterator]();case 5:if(a=(s=i.next()).done){t.next=13;break}if(o=s.value,!o.bg){t.next=10;break}return t.next=10,this.preloadStage(o.bg,o.id);case 10:a=!0,t.next=5;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](3),r=!0,n=t.t0;case 19:t.prev=19,t.prev=20,a||null==i.return||i.return();case 22:if(t.prev=22,!r){t.next=25;break}throw n;case 25:return t.finish(22);case 26:return t.finish(19);case 27:case"end":return t.stop()}},t,this,[[3,15,19,27],[20,,22,26]])}));function e(e){return t.apply(this,arguments)}return e}(),updateHeight:function(t){var e=this;return t<this.wrapHeight&&(t=this.wrapHeight),new Promise(function(a,r){t!==e.height?(e.height=t,e.$nextTick(function(){e.ctxScaleRatio(),a()})):(e.clearCtx("stageLayer"),a())})},setStageLayer:function(){var t=Object(T["a"])(regeneratorRuntime.mark(function t(e,a){var r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e.url){t.next=2;break}return t.abrupt("return");case 2:return h.$emit("load:start"),t.next=5,this.preloadStage(e,a).then(function(t){var a=e.w,n=e.h;a>r.width&&(n=r.width*n/a,a=r.width),r.getLayerCtx("stageLayer").drawImage(t,0,0,a*r.scaleRate,n*r.scaleRate),h.$emit("load:end")});case 5:case"end":return t.stop()}},t,this)}));function e(e,a){return t.apply(this,arguments)}return e}(),getPointBy:function(t){if(t.touches){var e=t.changedTouches[0],a=e.pageX,r=e.pageY,n=e.target.offsetParent,i=n.offsetLeft,s=n.offsetTop;return[parseInt(a-i,10),parseInt(r-s,10)]}return[parseInt(t.layerX,10),parseInt(t.layerY,10)]},handleMousedown:function(t){var e,a,r=(e=this.getPointBy(t),a=Object(M["a"])(e,2),this._px=a[0],this._py=a[1],e);switch(this._dragging=!0,this.layerType){case"C":this._points.length=0,this._points.push(r);break;case"E":break;case"S":break}},handleMouseout:function(){this._dragging&&(this._dragging=!1,this.handleMouseup())},handleMousemove:function(t){var e=this.getPointBy(t),a=this.getLayerCtx("editLayer"),r=Y(e[0],e[1],this._px,this._py,this.scaleRate),n=r.x,i=r.y,s=r.w,o=r.h;switch(this.layerType){case"C":if(!this._dragging)return void this.$emit("capture",{ac:"CM",data:[e[0]/this.scaleRate,e[1]/this.scaleRate]});if(this.straX&&(this.stra_y?e[1]=this.stra_y:this.stra_y=e[1]),this.straY&&(this.stra_x?e[0]=this.stra_x:this.stra_x=e[0]),this._px===e[0]&&this._py===e[1])return;this._px=e[0],this._py=e[1],this._points.push(e),this._points=N.a.radialDistance(this._points,this.tolerance);var c={co:this.color,wi:this.lineWidth,ty:this.layerType,po:this._points.slice()};this.$emit("capture",{ac:"CSync",data:c}),this.renderCurve(c,"editLayer",!0);break;case"E":if(!this._dragging)return;this.clearCtx("editLayer"),a.fillRect(n,i,s,o),a.save(),a.setLineDash([5]),a.strokeRect(n,i,s,o),a.restore();var u=Q(this.canvasObjs,{x:n,y:i,w:s,h:o});X(a,u,this.scaleRate);break;case"S":if(!this._dragging)return;this._prev_shape_rect&&q(a,this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=[n-10,i-10,s+20,o+20];var l={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,e[0]/this.scaleRate,e[1]/this.scaleRate]};this.renderShape(l,"editLayer");break}},handleMouseup:function(t){this._dragging=!1,this.stra_y=null,this.stra_x=null;var e=this.getPointBy(t),a=Y(e[0],e[1],this._px,this._py,this.scaleRate);switch(this.layerType){case"C":if(this._points.length>0){var r={po:this._points.slice(),co:this.color,wi:this.lineWidth,ty:this.layerType};this.clearCtx("editLayer",this._points),this.$emit("capture",{ac:"CEnd",data:r}),this.renderCurve(r),this._points.length=0}break;case"E":this.clearCtx("editLayer");var n=Q(this.canvasObjs,a),i=n.map(function(t){return t.id});if(!i.length)return void console.log("no earse");this.removeCanvasObjs(i),this.earseHistoryObjs.push(n),this.$emit("capture",{ac:"E",data:i}),this.reRenderCanvasData();break;case"S":var s={ty:"S",co:this.color,sty:this.shapeType,data:[this._px/this.scaleRate,this._py/this.scaleRate,e[0]/this.scaleRate,e[1]/this.scaleRate]};this._prev_shape_rect&&(q(this.getLayerCtx("editLayer"),this._prev_shape_rect,this.scaleRate),this._prev_shape_rect=null),this.renderShape(s),this.$emit("capture",{ac:"SEnd",data:s});break}},redrawEarseHistory:function(){var t=this.earseHistoryObjs.pop();if(t){this.batchRenderObjs(t);var e=!0,a=!1,r=void 0;try{for(var n,i=t[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value;this.addCanvasObj(s)}}catch(o){a=!0,r=o}finally{try{e||null==i.return||i.return()}finally{if(a)throw r}}this.$emit("capture",{ac:"UE",data:t})}},resetLayer:function(){this.canvasObjs=[],this.clearCtx("displayLayer"),this.clearCtx("editLayer"),this.clearCtx("stageLayer"),this.clearCtx("syncLayer")},reRenderCanvasData:function(t){t&&(this.canvasObjs=t),this.canvasObjs.length?this.batchRenderObjs(this.canvasObjs,!0):this.clearCtx("displayLayer")},cursorMove:function(t){if(this.showCursor)for(var e=0,a=Object.keys(t);e<a.length;e++){var r=a[e];this.$data[r]=t[r]}},removeCanvasObjs:function(t){return this.canvasObjs=this.canvasObjs.filter(function(e){return t.indexOf(e.id)<0}),this.canvasObjs},renderOneObj:function(t,e){var a=this;return new Promise(function(r,n){switch(t.ty){case"C":a.renderCurve(t,e),r();break;case"S":a.renderShape(t,e),r();break}})},batchRenderObjs:function(){var t=Object(T["a"])(regeneratorRuntime.mark(function t(e){var a,r,n,i,s,o,c,u=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a=u.length>1&&void 0!==u[1]&&u[1],this.clearCtx("fakeLayer"),r=!0,n=!1,i=void 0,t.prev=5,s=e[Symbol.iterator]();case 7:if(r=(o=s.next()).done){t.next=14;break}return c=o.value,t.next=11,this.renderOneObj(c,"fakeLayer");case 11:r=!0,t.next=7;break;case 14:t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](5),n=!0,i=t.t0;case 20:t.prev=20,t.prev=21,r||null==s.return||s.return();case 23:if(t.prev=23,!n){t.next=26;break}throw i;case 26:return t.finish(23);case 27:return t.finish(20);case 28:a&&this.clearCtx("displayLayer"),this.getLayerCtx("displayLayer").drawImage(this.$refs.fakeLayer,0,0,this.width*this.scaleRate,this.height*this.scaleRate);case 30:case"end":return t.stop()}},t,this,[[5,16,20,28],[21,,23,27]])}));function e(e){return t.apply(this,arguments)}return e}(),renderCurve:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"displayLayer",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.getLayerCtx(a);if(n.strokeStyle=n.fillStyle=Tt(t.co),n.lineWidth=t.wi*this.scaleRate,n.lineCap=n.lineJoin="round",r){var i=n._points;n.clearCurve=i?function(){return e.clearCtx(a,i)}:function(){},n._points=t.po}else"displayLayer"===a&&this.addCanvasObj(t);G(n,t.po,this.scaleRate,r)},renderShape:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"displayLayer",a=this.getLayerCtx(e);switch(t.sty){case"L":Z(a,t.data,this.scaleRate,t.co);break;case"AL":tt(a,t.data,this.scaleRate,t.co);break;case"R":et(a,t.data,this.scaleRate,t.co);break;case"C":at(a,t.data,this.scaleRate,t.co);break}"displayLayer"===e&&this.addCanvasObj(t)},getLayerCtx:function(t){return this.$refs[t].getContext("2d")},addCanvasObj:function(t){t.id=t.id||D.a.generate(),this.canvasObjs.push(t)},clearCtx:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"editLayer",e=arguments.length>1?arguments[1]:void 0;if(this.$refs[t]){var a=this.getLayerCtx(t);e?V(a,e,this.scaleRate):a.clearRect(0,0,this.canvasW,this.canvasH)}},setScaleRateBy:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.origin)this.scaleRate=1;else{var e=t.width||window.screen.width,a=e/this.width;t.height&&this.wrapHeight*a>t.height&&(a=t.height/this.wrapHeight),this.scaleRate=Math.floor(1e3*a)/1e3}},handleKeydown:function(t){16===t.keyCode&&(this.straX=!0,this.$toast.success("横直线模式生效")),18===t.keyCode&&(this.straY=!0,this.$toast.success("竖直线模式生效"))},handleKeyup:function(t){16===t.keyCode&&(this.straX=!1,this.$toast.warning("横直线模式失效")),18===t.keyCode&&(this.straY=!1,this.$toast.warning("竖直线模式失效"))},toggleCursor:function(t){this.showCursor=t},convertPDF2PNG:function(t,e){var a=this;return new Promise(function(r,n){t.getPage(e).then(function(t){var e=t.getViewport(1),n=2*a.width/e.width,i=t.getViewport(n),s=parseInt(i.height,10);a.pdfHeight=s/2,a.$nextTick(function(){t.render({canvasContext:a.getLayerCtx("pdfLayer"),viewport:i}).then(function(){r(a.$refs.pdfLayer.toDataURL("image/webp",.8))})})})})},putImageAsBg:function(t){var e=this;return new Promise(function(a,r){var n=new Image,i=e.getLayerCtx("pdfLayer");n.onload=function(){var r=n.width,s=n.height;r>2*e.width?(s=2*e.width*s/r,r=2*e.width,e.pdfHeight=s/2,e.$nextTick(function(){i.drawImage(n,0,0,r,s),a(e.$refs.pdfLayer.toDataURL("image/webp",.8))})):a(t)},n.src=t})},drawPointer:function(t){t.beginPath();var e=this.$refs.layerContainer.scrollTop*window.devicePixelRatio,a=this.curX*window.devicePixelRatio,r=this.curY*window.devicePixelRatio-e;a>0&&r>0&&(t.arc(a,r,12,0,2*Math.PI,!1),t.fillStyle=nt(this.curColor,100*this.curOp),t.fill())},captureCurrentImage:function(){var t=this,e=this.getLayerCtx("captureLayer"),a=["stageLayer","displayLayer","syncLayer"],r=this.$refs.layerContainer.scrollTop*window.devicePixelRatio;return a.forEach(function(a){"stageLayer"===a&&(e.fillStyle=t.playerBgColor,e.fillRect(0,0,t.canvasW,t.captureH)),e.drawImage(t.$refs[a],0,r,t.canvasW,t.captureH,0,0,t.canvasW,t.captureH)}),this.drawPointer(e),this.$refs.captureLayer},genVideoCover:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.getLayerCtx("fakeLayer");e.fillStyle="#fff",e.fillRect(0,0,this.width,this.height);var a=180;e.textBaseline="middle",e.font="22px Roboto",e.fillStyle="#666";var r=t.title,n=e.measureText(r).width;if(n<this.width){var i=this.width/2-n/2;e.fillText(r,i,80)}e.font="16px Roboto",e.fillStyle="#999";var s="由手绘微课录制",o=this.width/2-e.measureText(s).width/2;if(e.fillText(s,o,this.height-40),t.author){e.font="18px Roboto",e.fillStyle="#333";var c=this.width/2-e.measureText(t.author).width/2;e.fillText(t.author,c,a)}t.done(this.$refs.fakeLayer)}}},Pt=Rt,Et=(a("483e"),Object(b["a"])(Pt,O,A,!1,null,"1df8c94e",null)),Ot=Et.exports,At=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"controlBar"}},[a("mu-popover",{attrs:{open:t.openShapeCtrl,trigger:t.shapeCtrlTrigger,placement:"bottom"},on:{"update:open":function(e){t.openShapeCtrl=e}}},[a("mu-bottom-nav",{attrs:{value:t.shapeType},on:{change:t.handleChangeShapeType}},[a("mu-bottom-nav-item",{attrs:{value:"L",title:t.$t("ctrlBar.line"),icon:"short_text"}}),a("mu-bottom-nav-item",{attrs:{value:"AL",title:t.$t("ctrlBar.arrowLine"),icon:"trending_flat"}}),a("mu-bottom-nav-item",{attrs:{value:"C",title:t.$t("ctrlBar.circle"),icon:"panorama_fish_eye"}}),a("mu-bottom-nav-item",{attrs:{value:"R",title:t.$t("ctrlBar.rect"),icon:"crop_landscape"}})],1)],1),a("div",{staticClass:"main"},[a("div",{staticClass:"layer-ctrl"},[a("mu-bottom-nav",{attrs:{value:t.bottomNav},on:{change:t.handleChange}},[a("mu-bottom-nav-item",{attrs:{value:"C",title:t.$t("ctrlBar.pen"),icon:"edit"}}),a("mu-bottom-nav-item",{ref:"shapeBtn",attrs:{value:"S",title:t.$t("ctrlBar.shape"),icon:t.currentShapeIcon},nativeOn:{click:function(e){return t.toggleShapeCtrl(e)}}}),a("mu-bottom-nav-item",{attrs:{value:"E",title:t.$t("ctrlBar.eraser"),icon:"crop_free"}})],1)],1),a("div",{staticClass:"func-btns"},[a("mu-tooltip",{attrs:{content:t.$t("ctrlBar.undoErase"),placement:"top"}},[a("mu-button",{staticClass:"func-btn pc-only",attrs:{icon:""},on:{click:function(){return t.$emit("undo")}}},[a("mu-icon",{attrs:{value:"undo"}})],1)],1),a("mu-tooltip",{attrs:{content:t.$t("ctrlBar.penWidth"),placement:"top"}},[a("mu-button",{staticClass:"func-btn pc-only",attrs:{icon:""},on:{click:function(e){t.linePopup=!0}}},[a("mu-icon",{attrs:{value:"line_weight"}})],1)],1),a("mu-tooltip",{attrs:{content:t.$t("ctrlBar.penColor"),placement:"top"}},[a("mu-button",{staticClass:"func-btn pc-only",style:t.colorPickerStyle,attrs:{icon:""},on:{click:function(e){t.colorPopup=!0}}},[a("mu-icon",{attrs:{value:"color_lens"}})],1)],1),a("uploader",{staticClass:"func-btn",attrs:{autoStart:!1,options:t.uploadOptions},on:{"file-added":t.onFileAdded}},[a("uploader-btn",{attrs:{single:!0,attrs:t.uploadAttrs}},[a("mu-tooltip",{attrs:{content:t.$t("ctrlBar.uploadPdf"),placement:"top"}},[a("mu-button",{attrs:{icon:""}},[a("mu-icon",{attrs:{value:"picture_as_pdf"}})],1)],1)],1)],1),a("mu-menu",{staticClass:"func-btn only-mobile",attrs:{open:t.openMoreMenu,placement:"top-end"},on:{"update:open":function(e){t.openMoreMenu=e}}},[a("mu-button",{attrs:{icon:""}},[a("mu-icon",{attrs:{value:"more_vert"}})],1),a("mu-list",{attrs:{slot:"content"},slot:"content"},[a("mu-list-item",{attrs:{button:""},on:{click:function(){return t.$emit("undo")}}},[a("mu-list-item-action",[a("mu-icon",{attrs:{value:"undo"}})],1),a("mu-list-item-title",[t._v(t._s(t.$t("ctrlBar.undoErase")))])],1),a("mu-list-item",{attrs:{button:""},on:{click:function(e){t.linePopup=!0}}},[a("mu-list-item-action",[a("mu-icon",{attrs:{value:"line_weight"}})],1),a("mu-list-item-title",[t._v(t._s(t.$t("ctrlBar.penWidth")))])],1),a("mu-list-item",{attrs:{button:""},on:{click:function(e){t.colorPopup=!0}}},[a("mu-list-item-action",[a("mu-icon",{attrs:{value:"color_lens"}})],1),a("mu-list-item-title",[t._v(t._s(t.$t("ctrlBar.penColor")))])],1)],1)],1)],1)]),a("mu-dialog",{attrs:{"dialog-class":"color-picker",title:t.$t("ctrlBar.penColor"),open:t.colorPopup},on:{"update:open":function(e){t.colorPopup=e}}},[a("mu-flex",{attrs:{wrap:"wrap","justify-content":"center"}},t._l(t.colorList,function(e,r){return a("mu-flex",{key:r,staticClass:"color-item",style:"background:"+e,on:{click:function(a){return t.handleColorSelect(e,r)}}})}),1),a("mu-list",[a("mu-list-item",{attrs:{button:"",ripple:!1},on:{click:function(e){t.isOpacity=!t.isOpacity}}},[a("mu-list-item-title",[t._v("\n          "+t._s(t.$t("ctrlBar.opacity"))+"\n        ")]),a("mu-list-item-action",[a("mu-switch",{attrs:{readonly:""},model:{value:t.isOpacity,callback:function(e){t.isOpacity=e},expression:"isOpacity"}})],1)],1)],1)],1),a("mu-dialog",{attrs:{"dialog-class":"line-slider-pop",title:t.$t("ctrlBar.penWidth"),open:t.linePopup},on:{"update:open":function(e){t.linePopup=e}}},[a("div",{staticClass:"title"},[t._v("\n      "+t._s(t.$t("ctrlBar.penWidthVal",{px:t.lineWidth}))+"\n    ")]),a("div",{staticClass:"line-wrap"},[a("div",{staticClass:"sample-line",style:t.lineWidthStyle})]),a("mu-slider",{attrs:{max:20,step:1,min:1},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}})],1)],1)},Mt=[],Ft=a("9511"),Nt=a.n(Ft),Bt={name:"ControlBar",props:{},data:function(){return{colorPopup:!1,linePopup:!1,openMoreMenu:!1,colorList:["#e74000","#0088ff","#1d1d1d","#FFFF00","#FF9E9D","#5cb85c","#5E405F","#f5f5f5"],uploadOptions:{testChunks:!1,singleFile:!0},uploadAttrs:{accept:"application/pdf,image/*"},limitPageNum:100,shapeCtrlTrigger:null,openShapeCtrl:!1}},mounted:function(){Nt.a.workerSrc=pt+"/js/pdf.worker.js",this.shapeCtrlTrigger=this.$refs.shapeBtn.$el},computed:{bottomNav:function(){return this.$store.getters.currentLayerType},lineWidthStyle:function(){return"height:"+this.lineWidth+"px;background-color:"+this.color+";"},colorPickerStyle:function(){return"color:"+this.color},color:function(){return this.$store.getters.currentColor},lineWidth:{get:function(){return this.$store.getters.currentLineWidth},set:function(t){this.$store.commit("CHANGE_CANVAS_LINE_WIDTH",t)}},isOpacity:{get:function(){return this.$store.getters.isOpacity},set:function(t){this.$store.commit("CHANGE_CANVAS_OPACITY",t)}},layerType:function(){return this.$store.getters.currentLayerType},shapeType:function(){return this.$store.getters.currentShapeType},currentShapeIcon:function(){switch(this.$store.getters.currentShapeType){case"L":return"short_text";case"AL":return"trending_flat";case"C":return"panorama_fish_eye";case"R":return"crop_landscape"}}},methods:{handleChange:function(t){this.$store.commit("CHANGE_CANVAS_LAYER",t)},handleChangeShapeType:function(t){this.$store.commit("CHANGE_CANVAS_SHAPE_TYPE",t),this.openShapeCtrl=!1},toggleShapeCtrl:function(){this.openShapeCtrl=!this.openShapeCtrl},handleColorSelect:function(t,e){this.colorPopup=!1,this.$store.commit("CHANGE_CANVAS_COLOR",{color:t,idx:e})},onFileAdded:function(t){var e=this,a=t.fileType.match(/image/);h.$emit("load:start",a?"正在插入背景图片":"正在解析文件");var r=new FileReader;a?(r.readAsDataURL(t.file),r.onload=function(t){e.$emit("compressImage",t.target.result)}):(r.readAsArrayBuffer(t.file),r.onload=function(t){Nt.a.getDocument({data:t.target.result,cMapUrl:"/js/cmaps/",cMapPacked:!0}).then(function(t){h.$emit("load:end");var a=t.numPages;a>e.limitPageNum?h.$emit("dialog",{title:"提示",msg:"已超过文档上传页数限制: "+e.limitPageNum+"/"+a+", 继续操作，超出部分将不会被导入",confirm:function(){e.$emit("convertPdf",{pdf:t,missionNum:e.limitPageNum})}}):e.$emit("convertPdf",{pdf:t,missionNum:a})})})}}},Dt=Bt,zt=(a("fefa"),Object(b["a"])(Dt,At,Mt,!1,null,"5a422af8",null)),Wt=zt.exports,Ht=a("c093"),It=a.n(Ht),Ut=100,qt={name:"Editor",data:function(){return{showFrameListPop:!1,openMoreMenu:!1,currentTs:0,currentDur:0,recordPaused:!1,framesData:{},CDN_PF:pt,showPreference:!1}},components:{CanvasLayer:Ot,ControlBar:Wt},mounted:function(){var t=this;It.a.isRecordingSupported()||this.$toast.error(this.$t("editor.recordNotSupport"));var e=this.frameList[this.currentFrame-1];e.bg&&this.$refs.canvas.updateHeight(e.bg.h).then(function(){t.$refs.canvas.setStageLayer(e.bg,e.id)}),this.currentAc=null,this.auRecorder=new It.a({encoderPath:"/encoderWorker.min.js"}),this.auRecorder.onstart=function(){t.records=[],t.currentTs=1,t.$toast.success(t.$t("editor.recordStart"));var e=t.$refs.canvasWrap.scrollTop;t.addAcRecord("F",{id:t.currentFid,top:e}),t.addAcRecord("CC",t.currentColor),t.setupRecordClock()},this.auRecorder.onpause=function(){t.recordPaused=!0,t.clock.cancel(),t.$toast.success(t.$t("editor.paused"))},this.auRecorder.onresume=function(){t.recordPaused=!1,t.currentAc=null,t.setupRecordClock(),t.$toast.success(t.$t("editor.resumed"))},this.auRecorder.onstop=function(){t.addAcRecord("End"),t.clock.cancel(),t.currentTs=0,t.$store.commit("SET_CANVAS_OBJS",t.records);var e=E.a.uniq(t.records.filter(function(t){return"F"===t.ac}).map(function(t){return"object"===Object(R["a"])(t.data)?t.data.id:t.data})).map(function(e){return t.frameList.find(function(t){return t.id===e})});t.$store.commit("SET_STAGE_OBJS",e),t.$store.commit("SET_STAGE_BG_COLOR",t.currentBgColor),t.$store.commit("SET_PLAYER_SIZE",t.viewSize),t.$router.push({path:"preview"})},this.auRecorder.ondataavailable=function(e){var a=new Blob([e],{type:"audio/ogg"}),r=URL.createObjectURL(a);t.$store.commit("SET_AUDIO_TRACK",{url:r,blob:a})}},computed:{currentTsDisplay:function(){return ut()(this.currentDur).format("mm:ss")},currentColor:function(){return this.$store.getters.currentColor},currentBgColor:function(){return this.$store.getters.currentBgColor},currentFrame:function(){return this.$store.getters.currentFrame},frameList:function(){return this.$store.getters.frameList},currentFid:function(){return this.$store.getters.currentFid},frameNavDisplay:function(){return this.$t("editor.frameNo",{cur:this.currentFrame,len:this.frameList.length})},viewSize:function(){return this.$store.getters.viewSize},maxCanvasH:function(){return"max-height:"+this.viewSize[1]+"px;"},blackboard:{get:function(){return"#fff"!==this.currentBgColor},set:function(t){this.$store.commit("CHANGE_CANVAS_BG_COLOR",t?"#2C3E50":"#fff")}},tolerance:{get:function(){return this.$store.getters.preferences.tolerance},set:function(t){this.$store.commit("SET_PREFERENCE",{tolerance:t})}},lang:{get:function(){return this.$store.getters.preferences.lang},set:function(t){this.$store.commit("SET_PREFERENCE",{lang:t})}}},watch:{currentColor:function(t,e){this.addAcRecord("CC",t)},currentFrame:function(t,e){var a=this.frameList[e-1];a&&(this.framesData[a.id]=this.$refs.canvas.canvasObjs),this.loadFrameContent(t),this.skipCapture=!0,this.$refs.canvasWrap.scrollTop=0},lang:function(t){this._i18n.locale=t}},methods:{startRecord:function(){this.currentTs?this.auRecorder.stop():this.auRecorder.start()},pauseRecord:function(){this.recordPaused?this.auRecorder.resume():this.auRecorder.pause()},setupRecordClock:function(){var t=this;this.clock=rt(Ut,function(){t.currentTs+=Ut,t.currentTs%1e3===1&&(t.currentDur=t.currentTs),t.currentAc&&(t.records.push(t.currentAc),t.currentAc=null)})},handleCapture:function(t){if(this.currentTs){if(this.currentAc&&this.currentAc.ac!==t.ac&&"CEnd"===this.currentAc.ac)return;this.currentAc=Object.assign({},t,{ts:this.currentTs})}},addAcRecord:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.currentTs&&this.records.push({ac:t,ts:this.currentTs,data:e})},handleUndoEarse:function(){this.$refs.canvas.redrawEarseHistory()},handleNavFrame:function(t){var e=this.currentFrame+t;this.$store.commit("CHANGE_CURRENT_FRAME",e)},handleNavToFrame:function(t){this.$store.commit("CHANGE_CURRENT_FRAME",t+1),this.showFrameListPop=!1},removeCurFrame:function(){var t=this;this.$confirm("确定要删除当前第 "+this.currentFrame+" 页吗？","确认操作",{type:"warning",beforeClose:function(e,a,r){if(e)if(t.$store.commit("REMOVE_FRAME_BY_NUM",t.currentFrame),t.currentFrame>t.frameList.length){var n=0===t.frameList.length?1:t.currentFrame-1;t.$store.commit("CHANGE_CURRENT_FRAME",n)}else t.loadFrameContent(t.currentFrame);r()}})},loadFrameContent:function(t){var e=this,a=this.frameList[t-1].id,r=this.frameList[t-1].bg;this.$refs.canvas.updateHeight(r?r.h:this.viewSize[1]).then(function(){e.$refs.canvas.reRenderCanvasData(e.framesData[a]||[]),r&&e.$refs.canvas.setStageLayer(r,a)}),this.addAcRecord("F",this.currentFid)},handleScroll:function(t){this.skipCapture?this.skipCapture=!1:this.handleCapture({ac:"SL",data:t.target.scrollTop})},handleConvertPdf:function(){var t=Object(T["a"])(regeneratorRuntime.mark(function t(e){var a,r,n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:a=1,r=[];case 2:if(!(a<=e.missionNum)){t.next=9;break}return h.$emit("load:start","正在导入第 "+a+" 页/共 "+e.missionNum+" 页"),t.next=6,new Promise(function(t,i){n.$refs.canvas.convertPDF2PNG(e.pdf,a).then(function(e){_t(e,!0).then(function(e){r.push(e),t()})})});case 6:a++,t.next=2;break;case 9:this.$store.commit("INSERT_FRAME_BY_IMAGES",r),h.$emit("load:end");case 11:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),handleCompressImage:function(t){var e=this;this.$refs.canvas.putImageAsBg(t).then(function(t){_t(t,!0).then(function(t){e.$store.commit("INSERT_FRAME_BY_IMAGE",t),h.$emit("load:end")})})}}},Vt=qt,Gt=(a("c3af"),Object(b["a"])(Vt,x,$,!1,null,"66c35e5b",null)),Yt=Gt.exports,Jt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"c-container"},[a("mu-appbar",{attrs:{color:"primary",title:t.$t("contact.title"),"z-depth":0}},[a("mu-button",{attrs:{slot:"left",icon:"",to:"/"},slot:"left"},[a("mu-icon",{attrs:{value:"arrow_back"}})],1),a("mu-button",{attrs:{slot:"right",flat:"",href:"https://doc.17up.org",target:"_blank"},slot:"right"},[a("mu-icon",{attrs:{left:"",value:"help_outline"}}),t._v("\n      "+t._s(t.$t("contact.guide"))+"\n    ")],1)],1),a("div",{staticClass:"content"},[a("div",{staticClass:"header-wrap"},[a("div",{staticClass:"banner"},[a("img",{attrs:{src:t.CDN_PF+"/img/xcx/banner.png",alt:""}})]),a("div",{staticClass:"author"},[a("img",{attrs:{src:t.CDN_PF+"/img/wechat.jpeg",alt:""}}),a("div",[t._v("扫一扫微信联系, 获取更多服务支持")])])]),a("mu-stepper",{staticClass:"timeline",attrs:{orientation:"vertical",linear:!1}},t._l(t.progress,function(e,r){return a("mu-step",{key:r,attrs:{active:""}},[a("mu-step-label",[a("mu-icon",{attrs:{slot:"icon",value:"panorama_fish_eye",color:"primary"},slot:"icon"}),a("span",{staticClass:"version-title"},[t._v(t._s(e.date))])],1),a("mu-step-content",[t._v("\n          "+t._s(e.msg)+"\n        ")])],1)}),1)],1)],1)},Xt=[],Kt={name:"Contact",data:function(){return{CDN_PF:pt,progress:[{date:"2018年 10月22日",msg:"适配移动设备，支持微信内置浏览器使用"},{date:"2018年 6月 20日",msg:"国际化完成，英文版发布"},{date:"2018年 6月 14日",msg:"拥有生成导出mp4视频能力"},{date:"2018年 6月 1日",msg:"新增完全离线使用能力"},{date:"2018年 5月 22日",msg:"手绘微课Pro发布, 全新界面，全新交互，聚焦手写笔迹录制功能"}]}}},Qt=Kt,Zt=(a("3d23"),Object(b["a"])(Qt,Jt,Xt,!1,null,"f1d519c0",null)),te=Zt.exports,ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("mu-appbar",{attrs:{color:"primary",title:t.$t("mywork.title"),"z-depth":0}},[a("mu-button",{attrs:{slot:"left",icon:"",to:"/"},slot:"left"},[a("mu-icon",{attrs:{value:"arrow_back"}})],1),t.currentUser?a("mu-list",{attrs:{slot:"right"},slot:"right"},[a("mu-list-item",[a("mu-list-item-title",{staticClass:"user-account"},[t._v("\n          "+t._s(t.currentUser._email)+"\n        ")])],1)],1):t._e(),t.currentUser?a("mu-menu",{attrs:{slot:"right",placement:"bottom-end",open:t.openMoreMenu},on:{"update:open":function(e){t.openMoreMenu=e}},slot:"right"},[a("mu-button",{attrs:{flat:""}},[a("mu-icon",{attrs:{value:"more_vert"}})],1),a("mu-list",{attrs:{slot:"content"},slot:"content"},[a("mu-list-item",{attrs:{button:""},on:{click:t.handleLogout}},[a("mu-list-item-title",[t._v(t._s(t.$t("mywork.changeAccount")))])],1)],1)],1):t._e(),t.currentUser?t._e():a("mu-button",{attrs:{slot:"right",flat:"",primary:""},on:{click:t.requireLogin},slot:"right"},[t._v("\n      "+t._s(t.$t("mywork.login"))+"\n    ")])],1),a("div",{staticClass:"top-action"},[t.allCount?a("div",{staticClass:"list-item-count"},[t._v(t._s(t.$t("mywork.created"))+" "+t._s(t.allCount))]):t._e()]),a("div",{staticClass:"worklist"},[a("mu-load-more",{attrs:{loading:t.loading},on:{load:t.loadMore}},[t.currentUser?a("mu-list",{attrs:{textline:"two-line"}},[t.workList?[0===t.workList.length?a("div",{staticClass:"empty-tip"},[t._v("暂无任何作品")]):t._e(),t._l(t.workList,function(e,r){return a("mu-list-item",{key:r,attrs:{button:"",ripple:"",avatar:"",to:"/vd/"+e.id}},[a("mu-list-item-action",[a("mu-icon",{attrs:{value:"videocam",color:"#3f51b5"}})],1),a("mu-list-item-content",[a("mu-list-item-title",[t._v(t._s(e.t))]),a("mu-list-item-sub-title",[a("small",[t._v("创建于")]),t._v(" "+t._s(e.c_at))])],1),a("mu-list-item-action",[a("mu-list-item-after-text",{staticClass:"vd-dur"},[t._v(t._s(e.duration))])],1)],1)})]:t._e()],2):t._e()],1)],1)],1)},ae=[];ut.a.locale("zh-CN");var re={name:"MyWork",data:function(){return{allCount:0,workList:null,loading:!1,openMoreMenu:!1,uploadAttrs:{accept:"application/zip"},uploadOptions:{testChunks:!1,singleFile:!0}}},computed:{currentUser:function(){return this.$store.getters.currentUser}},watch:{currentUser:function(t){this.checkLogin(t)}},mounted:function(){this.checkLogin(this.currentUser)},methods:{checkLogin:function(t){t?(h.$emit("load:start"),this.loadVideos({uid:t.id},function(){h.$emit("load:end")})):this.requireLogin()},requireLogin:function(){h.$emit("requireLogin")},loadVideos:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;this.query=e,jt(e,function(r,n,i){t.hasNext=n;var s=r;e.offset&&(s=t.list.concat(r)),t.workList=s,t.allCount=i,a&&a()})},loadMore:function(){if(this.hasNext){var t=Object.assign(this.query,{offset:this.workList.length});this.loadVideos(t)}},handleLogout:function(){this.$store.commit("SET_CURRENT_USER",null)}}},ne=re,ie=(a("38ae"),Object(b["a"])(ne,ee,ae,!1,null,"743da7c9",null)),se=ie.exports,oe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("mu-appbar",{attrs:{color:"primary",title:t.$t("preview.title"),"z-depth":0}},[a("mu-button",{attrs:{slot:"left",icon:"",to:"/"},slot:"left"},[a("mu-icon",{attrs:{value:"arrow_back"}})],1),t.audioTrack.blob.size?a("mu-button",{staticClass:"btn",attrs:{slot:"right",flat:"",primary:""},on:{click:t.openUploadDialog},slot:"right"},[a("mu-icon",{attrs:{left:"",value:"cloud_upload"}}),t._v("\n      "+t._s(t.$t("preview.upload"))+"\n    ")],1):t._e()],1),a("div",{staticClass:"preview-container"},[a("player",{attrs:{audioUrl:t.audioTrack.url,canvasObjs:t.canvasObjs,stages:t.stages,autoPlay:!0,bgColor:t.stageBgColor,size:t.playerSize,duration:t.duration}})],1),a("mu-dialog",{attrs:{open:t.dialog,width:"460",title:t.$t("preview.upload")},on:{"update:open":function(e){t.dialog=e}}},[a("mu-text-field",{ref:"titleInput",attrs:{fullWidth:"",required:"",name:"title",type:"text",maxLength:30,autofocus:"",label:"给本次录制的微课命名"},model:{value:t.title,callback:function(e){t.title="string"===typeof e?e.trim():e},expression:"title"}}),a("mu-button",{attrs:{slot:"actions",flat:"",color:"secondary"},on:{click:function(e){t.dialog=!1}},slot:"actions"},[t._v("\n      "+t._s(t.$t("app.cancelBtn"))+"\n    ")]),a("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:t.publishVideo},slot:"actions"},[t._v("\n      "+t._s(t.$t("preview.pubBtn"))+"\n    ")])],1)],1)},ce=[],ue=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"player-wrap"},[a("div",{staticClass:"canvas-container"},[a("canvas-layer",{ref:"canvas",attrs:{isPlayer:!0,playerBgColor:t.bgColor,width:t.size[0],wrapHeight:t.size[1]}}),a("div",{staticClass:"coverage",on:{click:t.handlePlay}},[t.currentTs?t._e():[a("mu-paper",{staticClass:"video-ctrl-cover",attrs:{circle:"",zDepth:1}},[a("mu-icon",{attrs:{value:"play_arrow"}})],1),a("div",{staticClass:"video-dur"},[t._v(t._s(t.hDur))])]],2)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.currentTs,expression:"currentTs"}],staticClass:"ctrl-bar"},[a("span",{staticClass:"btn"},[a("i",{staticClass:"mu-icon material-icons",on:{click:t.handlePlay}},[t._v("\n        "+t._s(t.currentTs&&!t.isPaused?"pause":"play_arrow")+"\n      ")])]),t.isPaused&&t.canSeek?a("mu-slider",{attrs:{step:1,"track-color":"white",color:"#01579b"},on:{change:t.onChangeProgress},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}):t._e(),t.isPaused&&t.canSeek?t._e():a("mu-linear-progress",{attrs:{mode:"determinate",size:t.progressSize,color:"#fff",value:t.progress}}),a("span",{staticClass:"time"},[t._v(t._s(t.currentTsDisplay))])],1)])},le=[],de=a("1e5c"),he=100,fe={name:"Player",components:{CanvasLayer:Ot},props:{audioUrl:{type:String,require:!0},canvasObjs:{type:Array,require:!0},duration:{type:Number,require:!0},autoPlay:{type:Boolean,default:!1},stages:{type:Array},bgColor:{type:String},canSeek:{type:Boolean,default:!0},size:{type:Array,default:function(){return[900,506]}}},data:function(){return{currentTs:0,currentDur:0,progress:0,progressSize:5,isPaused:!1,framesData:{}}},computed:{currentTsDisplay:function(){return ut()(this.currentDur).format("mm:ss")},hDur:function(){return ut()(this.duration).format("mm:ss")}},mounted:function(){this.canvasLayer=this.$refs["canvas"],this.autoPlay&&this.canvasObjs.length&&this.preloadResource(this.startPlay)},beforeDestroy:function(){this.currentTs&&this.stopPlay(),this.currentAudio&&this.currentAudio.unload()},methods:{startPlay:function(){this.setupPlayerClock(),this.currentAudio.play(),this.$emit("played"),this.canvasLayer.toggleCursor(!0)},pausePlay:function(){this.clock&&this.clock.cancel(),this.currentAudio.pause(),this.isPaused=!0,this.$toast.success("已暂停")},resumePlay:function(){var t=Object(T["a"])(regeneratorRuntime.mark(function t(){var e,a,r,n,i,s,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.seekToTs||this.seekToTs===this.currentTs){t.next=12;break}return e=this.frameByTs(this.seekToTs),this.currentTs=this.seekToTs,a=this.parseRealPathByRange(0,this.currentTs),r=a.cd,n=a.framesData,i=a.curFid,s=a.top,o=a.color,this.framesData=n,this.curFid=i,this.frameChange(e.data.id,s),this.canvasLayer.cursorMove({curColor:o}),this.canvasLayer.reRenderCanvasData(r),t.next=11,this.seekAudio(this.currentTs);case 11:this.seekToTs=0;case 12:this.setupPlayerClock(),this.isPaused&&this.currentAudio.play(),this.isPaused=!1;case 15:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),stopPlay:function(){this.clock&&this.clock.cancel(),this.currentAudio&&this.currentAudio.stop(),this.currentTs=0,this.isPaused=!1,this.canvasLayer.toggleCursor(!1),this.canvasLayer.resetLayer(),this.framesData={},this.curFid=null,this.canvasLayer.scrollLayerContainer(0)},handlePlay:function(){this.currentTs?this.isPaused?this.resumePlay():this.pausePlay():this.preloadResource(this.startPlay)},doEachTask:function(t){var e=this;return new Promise(function(a,r){e.canvasObjs.filter(function(e){return t-he<=e.ts&&e.ts<t}).forEach(e.playEachRecord),t%1e3===0&&(e.currentDur=t),e.progress=t/e.duration*100,a()})},setupPlayerClock:function(){var t=this;this.clock=rt(he,function(){t.currentTs+=he,t.doEachTask(t.currentTs)})},playEachRecord:function(t){switch(t.ac){case"CSync":case"Cy":this.canvasLayer.renderCurve(t.data,"syncLayer",!0);var e=t.data.po[t.data.po.length-1];this.canvasLayer.cursorMove({curX:e[0],curY:e[1],curOp:.5});break;case"CEnd":case"CE":this.canvasLayer.clearCtx("syncLayer"),this.canvasLayer.renderCurve(t.data);break;case"E":this.canvasLayer.removeCanvasObjs(t.data),this.canvasLayer.reRenderCanvasData();break;case"CM":this.canvasLayer.cursorMove({curX:t.data[0],curY:t.data[1],curOp:1});break;case"F":this.preFid=this.curFid;var a=0;"object"===Object(R["a"])(t.data)?(this.curFid=t.data.id,a=t.data.top):this.curFid=t.data,this.preFid&&(this.framesData[this.preFid]=this.canvasLayer.canvasObjs),this.frameChange(this.curFid,a);break;case"SL":this.canvasLayer.scrollLayerContainer(t.data);break;case"SEnd":this.canvasLayer.renderShape(t.data);break;case"End":this.progress=100,this.stopPlay();break;case"CC":this.canvasLayer.cursorMove({curColor:t.data});break;case"UE":this.canvasLayer.batchRenderObjs(t.data);var r=!0,n=!1,i=void 0;try{for(var s,o=t.data[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var c=s.value;this.canvasLayer.addCanvasObj(c)}}catch(u){n=!0,i=u}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}break}},preloadResource:function(t){this.canvasLayer.preloadStages(this.stages),this.loadAudio(t)},groupRecordsByFrameRate:function(){var t=0,e=[];while(t<this.duration)t+=he,e.push(this.canvasObjs.filter(function(e){return t-he<=e.ts&&e.ts<t}));return e},loadAudio:function(t){var e=this;this.currentAudio?t():this.currentAudio=new de["Howl"]({src:[this.audioUrl,this.audioUrl+".MP3"],html5:!0,format:["ogg","mp3"],onload:t,onloaderror:function(){e.$toast.error("音频加载失败")}})},onChangeProgress:function(t){this.canSeek&&(this.seekToTs=Math.round(t*this.duration/100),this.currentDur=this.seekToTs)},seekAudio:function(t){var e=this;return new Promise(function(a,r){e.currentAudio?(e.currentAudio.once("seek",a),e.currentAudio.seek(t/1e3)):a()})},fitScreenWidth:function(){this.$refs.canvas.setScaleRateBy()},fitToOriginWidth:function(){this.$refs.canvas.setScaleRateBy({origin:!0})},frameByTs:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.canvasObjs.filter(function(t){return"F"===t.ac}).reverse();for(var r in a)if(a[r].ts-t<=0)return e.to?a[r-e.to]:a[r]},frameChange:function(t,e){var a=this,r=this.stages.find(function(e){return e.id===t});if(r){var n=r.bg;this.canvasLayer.updateHeight(n?n.h:this.size[1]).then(function(){a.canvasLayer.reRenderCanvasData(a.framesData[r.id]||[]),n&&a.canvasLayer.setStageLayer(n,r.id),a.canvasLayer.scrollLayerContainer(e)})}},parseRealPathByRange:function(t,e){var a,r,n,i,s,o=["F","CEnd","E","SEnd","CC","UE","SL"],c=[],u=this.canvasObjs.filter(function(a){return o.indexOf(a.ac)>-1&&t<=a.ts&&a.ts<=e});0===t&&(n={},a=r=null);var l=!0,d=!1,h=void 0;try{for(var f,p=function(){var e=f.value;switch(e.ac){case"CEnd":case"SEnd":c.push(e.data);break;case"SL":i=e.data;break;case"CC":s=e.data;break;case"E":c=c.filter(function(t){return e.data.indexOf(t.id)<0});break;case"UE":Array.isArray(e.data)&&c.concat(e.data);break;case"F":0===t?(a=r,r=e.data,a&&(n[a]=c.slice(0)),c=n[r]||[]):c=[];break}},m=u[Symbol.iterator]();!(l=(f=m.next()).done);l=!0)p()}catch(v){d=!0,h=v}finally{try{l||null==m.return||m.return()}finally{if(d)throw h}}return 0===t?{cd:c,framesData:n,curFid:r,top:i,color:s}:{cd:c,top:i}}}},pe=fe,me=(a("b47c"),Object(b["a"])(pe,ue,le,!1,null,"6d3e679e",null)),ve=me.exports,ge={name:"Preview",components:{Player:ve},data:function(){return{dialog:!1,openMoreMenu:!1,title:""}},computed:{audioTrack:function(){return this.$store.getters.audioTrack},canvasObjs:function(){return this.$store.getters.canvasObjs},duration:function(){return this.$store.getters.duration},stages:function(){return this.$store.getters.stages},currentUser:function(){return this.$store.getters.currentUser},stageBgColor:function(){return this.$store.getters.stageBgColor},playerSize:function(){return this.$store.getters.playerSize}},watch:{currentUser:function(t){t&&(this.dialog=!0)}},mounted:function(){this.audioTrack.blob.size||this.$toast.error("音频资源已失效")},methods:{openUploadDialog:function(){this.currentUser?this.dialog=!0:h.$emit("requireLogin")},publishVideo:function(){var t=this;this.title.length<=30&&(h.$emit("load:start","发布中..."),kt(this.audioTrack.blob).then(function(e){var a=t.audioTrack.blob.size;t.stages.forEach(function(t){t.bg&&(a+=t.bg.size)});var r=t.stages.find(function(t){return t.bg});$t({ap:e,cd:JSON.stringify({stage:t.stages,canvas:t.canvasObjs,dur:t.duration,size:t.playerSize,bgcolor:t.stageBgColor,resSize:a}),t:t.title,dur:t.duration,cover_url:r?r.bg.url:""},function(e){t.title="",t.dialog=!1,h.$emit("load:end"),t.$router.replace({path:"/vd/".concat(e)})})}).catch(function(){t.$toast.error(t.$t("preview.pubFail"))}))}}},ye=ge,be=Object(b["a"])(ye,oe,ce,!1,null,"8397ab94",null),Ce=be.exports,we=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("mu-appbar",{staticClass:"video-header",attrs:{color:"primary","z-depth":0,title:t.info.t}},[a("mu-button",{attrs:{slot:"left",icon:""},slot:"left"},[a("mu-icon",{attrs:{value:":icon-17up"}})],1),a("mu-list",{attrs:{slot:"right"},slot:"right"},[a("mu-list-item",{staticClass:"author-card"},[a("mu-list-item-title",{staticClass:"author-name"},[t._v(t._s(t.info.created_by.nickname))])],1)],1),t.info.c_at?a("mu-menu",{attrs:{slot:"right",open:t.openMoreMenu,placement:"bottom-end"},on:{"update:open":function(e){t.openMoreMenu=e}},slot:"right"},[a("mu-button",{attrs:{flat:""}},[a("mu-icon",{attrs:{value:"more_vert"}})],1),a("mu-list",{attrs:{slot:"content"},slot:"content"},[a("mu-list-item",{attrs:{button:""},on:{click:t.requestFullscreen}},[a("mu-list-item-title",[t._v("全屏播放")])],1),t.info.xcxcode?a("mu-list-item",{attrs:{button:""},on:{click:function(e){t.showQrcode=!0}}},[a("mu-list-item-title",[t._v("扫码观看")])],1):t._e(),a("mu-list-item",{attrs:{button:"",to:"/"}},[a("mu-list-item-title",[t._v("去创作")])],1),t.isAuthor?a("mu-list-item",{attrs:{button:""},on:{click:t.removeVideo}},[a("mu-list-item-title",{staticClass:"remove-menu"},[t._v("删除")])],1):t._e()],1)],1):t._e()],1),a("div",{staticClass:"preview-container"},[t.info.cd?a("player",{ref:"player",attrs:{audioUrl:t.info.ap,canvasObjs:t.info.cd.canvas,stages:t.info.cd.stage,duration:t.info.dur,size:t.info.cd.size,bgColor:t.info.cd.bgcolor},on:{played:t.plusPlayCount}}):t._e()],1),a("mu-dialog",{attrs:{"dialog-class":"qrcode-dialog",open:t.showQrcode},on:{"update:open":function(e){t.showQrcode=e}}},[a("img",{attrs:{src:t.info.xcxcode,alt:""}}),a("div",[t._v("请使用微信扫一扫观看")])])],1)},_e=[],ke={name:"Video",components:{Player:ve},data:function(){return{info:{t:"",created_by:{nickname:""}},showQrcode:!1,openMoreMenu:!1}},computed:{currentUser:function(){return this.$store.getters.currentUser},isAuthor:function(){return this.currentUser&&this.currentUser.id===this.info.created_by.id}},watch:{},mounted:function(){var t=this;this.getVideoBy(this.$route.params.id),window.addEventListener("orientationchange",function(){t.$refs.player.fitScreenWidth(),window.screen.orientation&&"landscape-primary"===window.screen.orientation.type&&t.$confirm("建议开启全屏模式, 获取最佳观看体验","提示",{type:"info",beforeClose:function(e,a,r){e&&t.requestFullscreen(),r()}})}),document.addEventListener("webkitfullscreenchange",function(e){var a=document.mozFullScreen||document.webkitIsFullScreen;a||t.$refs.player.fitToOriginWidth()})},methods:{getVideoBy:function(t){var e=this;h.$emit("load:start"),Lt(t,function(t){e.info=t,e.$nextTick(function(){window.screen.width<900&&e.$refs.player.fitScreenWidth()}),h.$emit("load:end")})},plusPlayCount:function(){xt(this.$route.params.id)},requestFullscreen:function(t){this.openMoreMenu=!1;var e=this.$refs.player.$el;t&&this.$refs.player.fitScreenWidth(),e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},removeVideo:function(){var t=this;this.openMoreMenu=!1,this.$confirm("确定要删除 "+this.info.t+" 吗？无法恢复","确认操作",{type:"warning",beforeClose:function(e,a,r){e&&(h.$emit("load:start","正在删除..."),St(t.info.id,function(e){h.$emit("load:end"),t.$router.replace({path:"/mywork"})})),r()}})}}},je=ke,Le=(a("e536"),Object(b["a"])(je,we,_e,!1,null,null,null)),Se=Le.exports;r["a"].use(S["a"]);var xe,$e,Te,Re,Pe=new S["a"]({routes:[{path:"/",name:"Editor",component:Yt},{path:"/preview",name:"Preview",component:Ce},{path:"/mywork",name:"MyWork",component:se},{path:"/vd/:id",name:"Video",component:Se},{path:"/contact",name:"Contact",component:te}]}),Ee=a("bc3a"),Oe=a.n(Ee),Ae=a("2f62"),Me=a("0e44"),Fe=a("bd86"),Ne="CHANGE_CANVAS_COLOR",Be="CHANGE_CANVAS_OPACITY",De="CHANGE_CANVAS_BG_COLOR",ze="CHANGE_CANVAS_LINE_WIDTH",We="CHANGE_CANVAS_LAYER",He="CHANGE_CANVAS_VIEW_SIZE",Ie="CHANGE_CANVAS_SHAPE_TYPE",Ue="CHANGE_CURRENT_FRAME",qe="SET_CANVAS_OBJS",Ve="SET_AUDIO_TRACK",Ge="SET_STAGE_OBJS",Ye="SET_STAGE_BG_COLOR",Je="SET_PLAYER_SIZE",Xe="INSERT_FRAME_BY_IMAGES",Ke="INSERT_FRAME_BY_IMAGE",Qe="REMOVE_FRAME_BY_NUM",Ze="SET_CURRENT_USER",ta="SET_PREFERENCE",ea={color:"#1d1d1d",colorIndex:3,lineWidth:2,bgColor:"#fff",layerType:"C",shapeType:"L",isOpacity:!1,viewSize:[900,506]},aa={currentBgColor:function(t){return t.bgColor},isOpacity:function(t){return t.isOpacity},currentColor:function(t){return t.isOpacity?nt(t.color,50):t.color},currentLineWidth:function(t){return t.lineWidth},currentLayerType:function(t){return t.layerType},colorIndex:function(t){return t.colorIndex},currentShapeType:function(t){return t.shapeType},viewSize:function(t){var e=window.screen.availWidth,a=window.screen.availHeight;if(Math.min(e,a)<450){e>560&&(e=560);var r=e<a?4/3:.75,n=parseInt(r*e,10);return[e,n]}return t.viewSize}},ra=(xe={},Object(Fe["a"])(xe,De,function(t,e){t.bgColor=e}),Object(Fe["a"])(xe,Ne,function(t,e){var a=e.color,r=e.idx;t.color=a,t.colorIndex=r+1}),Object(Fe["a"])(xe,ze,function(t,e){t.lineWidth=e}),Object(Fe["a"])(xe,We,function(t,e){t.layerType=e}),Object(Fe["a"])(xe,Ie,function(t,e){t.shapeType=e}),Object(Fe["a"])(xe,Be,function(t,e){t.isOpacity=e}),Object(Fe["a"])(xe,He,function(t,e){t.viewSize=e}),xe),na={state:ea,getters:aa,mutations:ra},ia={canvasObjs:[],audioTrack:{url:null,blob:null},stages:[],stageBgColor:"#fff",playerSize:[]},sa={canvasObjs:function(t){return t.canvasObjs},duration:function(t){var e=t.canvasObjs.find(function(t){return"End"===t.ac});return e?e.ts:0},audioTrack:function(t){return t.audioTrack},stages:function(t){return t.stages},stageBgColor:function(t){return t.stageBgColor},playerSize:function(t){return t.playerSize}},oa=($e={},Object(Fe["a"])($e,qe,function(t,e){t.canvasObjs=e}),Object(Fe["a"])($e,Ve,function(t,e){t.audioTrack=e}),Object(Fe["a"])($e,Ge,function(t,e){t.stages=e}),Object(Fe["a"])($e,Ye,function(t,e){t.stageBgColor=e}),Object(Fe["a"])($e,Je,function(t,e){t.playerSize=e}),$e),ca={state:ia,getters:sa,mutations:oa},ua={frameNo:1,frameList:[{id:D.a.generate(),bg:{url:"".concat(pt,"/img/xcx/banner2.png"),w:2800,h:800}}]},la={currentFrame:function(t){return t.frameNo},frameList:function(t){return t.frameList},currentFid:function(t){return t.frameList[t.frameNo-1].id}},da=(Te={},Object(Fe["a"])(Te,Ue,function(t,e){e>0&&(t.frameNo=e),e>t.frameList.length&&t.frameList.push({id:D.a.generate()})}),Object(Fe["a"])(Te,Ke,function(t,e){t.frameList.splice(t.frameNo,0,{id:D.a.generate(),bg:e}),t.frameNo+=1}),Object(Fe["a"])(Te,Xe,function(t,e){var a=t.frameList.length;e.forEach(function(e){t.frameList.push({id:D.a.generate(),bg:e})}),e.length>0&&(t.frameNo=a+1)}),Object(Fe["a"])(Te,Qe,function(t,e){t.frameList.splice(e-1,1)}),Te),ha={state:ua,getters:la,mutations:da},fa={currentUser:null,preferences:{tolerance:4,lang:navigator.language.match(/zh/)?"zh":"en"}},pa={currentUser:function(t){return t.currentUser},preferences:function(t){return t.preferences}},ma=(Re={},Object(Fe["a"])(Re,Ze,function(t,e){t.currentUser=e?Object.assign({},e,{uid:e.objectId}):null}),Object(Fe["a"])(Re,ta,function(t,e){t.preferences=Object.assign({},t.preferences,e)}),Re),va={state:fa,getters:pa,mutations:ma};r["a"].use(Ae["a"]);var ga=!1,ya=new Ae["a"].Store({plugins:[Object(Me["a"])()],modules:{canvas:na,record:ca,frame:ha,user:va},strict:ga}),ba=(a("499a"),a("a7fe")),Ca=a.n(ba),wa=a("ef55"),_a=a.n(wa),ka=a("caf9"),ja=a("9483");Object(ja["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});a("d6f6"),a("aa12"),a("c9ad");var La={app:{cancelBtn:"取消",confirmBtn:"确定",requireLoginTip:"请先登录您的账号",loading:"加载中..."},account:{userLogin:"用户登录",userRegister:"新用户注册",email:"邮箱",pwd:"密码",nick:"昵称",login:"登录",register:"注册"},editor:{recordStart:"开始录制",pause:"暂停",resume:"继续",paused:"已暂停",resumed:"已继续",mywork:"我的微课",preference:"偏好设置",canvasPref:"画布配置",langPref:"语言设置",pencilPref:"笔迹配置",blackboardMode:"模拟黑板背景",blackboardModeSub:"影响所有页面背景色",pencilT:"笔迹灵敏度",pencilTSub:"越小越灵敏",feedback:"反馈",viewFrameList:"分页快速预览",deleteCurFrame:"删除当前页",pausedRecordTip:"已暂停录制",recordResume:"继续录制",canvasHTip:"当前画布录制高度限定为",frameNo:"第 {cur}/{len} 页",recordNotSupport:"当前设备不支持语音录制"},ctrlBar:{line:"直线",arrowLine:"箭头",circle:"圆形",rect:"矩形",pen:"画笔",shape:"作图",eraser:"橡皮擦",undoErase:"撤销擦除",penWidth:"画笔粗细",penColor:"画笔调色",uploadPdf:"上传课件",opacity:"荧光模式",penWidthVal:"当前 {px} 像素"},mywork:{title:"我的微课",changeAccount:"切换账号",login:"去登录",uploadLocal:"上传本地微课",created:"已创作"},contact:{title:"向作者反馈",guide:"用户指南"},preview:{title:"预览",upload:"上传并发布",save:"保存到本地",pubBtn:"发布",pubFail:"发布失败"},video:{download:"下载此微课到本地"}},Sa={app:{cancelBtn:"Cancel",confirmBtn:"Confirm",requireLoginTip:"Please login your account",loading:"loading..."},account:{userLogin:"User Login",userRegister:"New User Register",email:"Email",pwd:"Password",nick:"Nickname",login:"Login",register:"Register"},editor:{recordStart:"Record",pause:"Pause",resume:"Resume",paused:"Paused",resumed:"Resumed",mywork:"My work",preference:"Preference",canvasPref:"Canvas",pencilPref:"Pencil",langPref:"Language",blackboardMode:"Blackboard Mode",blackboardModeSub:"fit all frames",pencilT:"Pencil Tolerance",pencilTSub:"smaller better",feedback:"Feedback",viewFrameList:"Frame List",deleteCurFrame:"Remove Current Frame",pausedRecordTip:"Record Paused",recordResume:"Resume Record",canvasHTip:"Current canvas height limited to ",frameNo:"Page {cur} of {len}",recordNotSupport:"Current device does not support audio recording"},ctrlBar:{line:"Line",arrowLine:"Arrow Line",circle:"Circle",rect:"Rect",pen:"Pencil",shape:"Shape",eraser:"Eraser",undoErase:"Undo Last Erase",penWidth:"Pencil Width",penColor:"Pick Color",uploadPdf:"Upload PDF",opacity:"Opacity Mode",penWidthVal:"Current {px} pixel"},mywork:{title:"My Work",changeAccount:"Change Account",login:"Login",uploadLocal:"Upload Local Course",created:"Created"},contact:{title:"Contact Me",guide:"User Guide"},preview:{title:"Preview",upload:"Upload & Publish",save:"Save To Local",pubBtn:"Publish",pubFail:"Publish failed!"},video:{download:"Download this video to local"}};r["a"].config.productionTip=!1,r["a"].use(n["a"]),r["a"].use(u["a"]),r["a"].use(s["a"]),r["a"].use(i["a"],{position:"top",time:4e3}),c.a.use("light"),r["a"].use(_a.a),r["a"].use(Ca.a,Oe.a),r["a"].use(ka["a"],{attempt:2}),v.a.init("1e40ebdba903ddf4aa47",{logLevel:"debug"});var xa=new u["a"]({locale:ya.getters.preferences.lang,messages:{zh:La,en:Sa}});new r["a"]({router:Pe,i18n:xa,store:ya,render:function(t){return t(L)}}).$mount("#app"),document.body.addEventListener("touchmove",function(t){t.preventDefault()})},5820:function(t,e,a){},"7faf":function(t,e,a){"use strict";var r=a("8fba"),n=a.n(r);n.a},"8fba":function(t,e,a){},b47c:function(t,e,a){"use strict";var r=a("0f97"),n=a.n(r);n.a},bb34:function(t,e,a){},c3af:function(t,e,a){"use strict";var r=a("2f6d"),n=a.n(r);n.a},c9ad:function(t,e,a){},e536:function(t,e,a){"use strict";var r=a("5820"),n=a.n(r);n.a},f5e8:function(t,e,a){"use strict";var r=a("bb34"),n=a.n(r);n.a},fa8e:function(t,e,a){},fefa:function(t,e,a){"use strict";var r=a("1743"),n=a.n(r);n.a}});
//# sourceMappingURL=app.f0442f9b.js.map